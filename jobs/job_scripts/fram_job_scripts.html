

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Job Scripts on Fram &mdash; Sigma2/Metacenter documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Sigma2/Metacenter documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">News</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://opslog.sigma2.no">Latest changes and events</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.sigma2.no/hardware-status">Hardware live status</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/support_line.html">Support line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/lost_forgotten_password.html">Lost or expiring password</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/project_leader_support.html">Project leader support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/advanced_user_support.html">Advanced User Support (AUS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/publish_research_data.html">Publish Research Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../frontpage.html">The Norwegian Academic HPC Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/applying_account.html">How do I get an HPC account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/training.html">Training material</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/create_ssh_keys.html">SSH</a></li>
</ul>
<p class="caption"><span class="caption-text">HPC Machines</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/hardware_overview.html">Overview over our machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/betzy.html">Betzy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/fram.html">Fram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/saga.html">Saga</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hpc-uit.readthedocs.io">Stallo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/migration2metacenter.html">Migration to a Metacenter HPC machine</a></li>
</ul>
<p class="caption"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../software/modulescheme.html">Software Module Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/installed_software.html">Installed Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/containers.html">Running Singularity and Docker containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/userinstallsw.html">How can I, as a user, install software for myself or my project with EasyBuild?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/userinstallsw.html#how-can-i-as-user-install-python-packages">How can I as user install Python packages?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/licenses.html">Licenses and access policies</a></li>
</ul>
<p class="caption"><span class="caption-text">Jobs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../submitting.html">Submitting jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../choosing_job_types.html">Job Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../job_scripts.html">Job Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../running-scientific-software.html">Running scientific software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring.html">Monitoring jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../choosing_memory_settings.html">How to choose the right amount of memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common_job_failures.html">Common job failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html">How to check the performance and scaling using Arm Performance Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactive_jobs.html">Interactive jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projects_accounting.html">Projects and accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network-access.html">No network access on compute nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dos_and_donts.html">Dos and Don’ts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides.html">Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Files and Storage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/nird.html">NIRD - National Infrastructure for Research Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/performance.html">Storage performance tuning</a></li>
</ul>
<p class="caption"><span class="caption-text">Code Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code_development/building.html">Building scientific software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_development/compilers.html">Compilers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_development/performance.html">Performance Analysis and Tuning</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sigma2/Metacenter documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Job Scripts on Fram</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/UNINETTSigma2/documentation/blob/master/jobs/job_scripts/fram_job_scripts.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="job-scripts-on-fram">
<h1>Job Scripts on Fram<a class="headerlink" href="#job-scripts-on-fram" title="Permalink to this headline">¶</a></h1>
<p>This page documents how to specify the queue system parameters for the
different job types on Fram.  See <a class="reference internal" href="../job_types/fram_job_types.html"><span class="doc std std-doc">Fram Job Types</span></a>
for information about the different job types on Fram.</p>
<div class="section" id="normal">
<h2>Normal<a class="headerlink" href="#normal" title="Permalink to this headline">¶</a></h2>
<p>The basic type of job on Fram is the <em>normal</em> job.  Most of the other
job types are “variants” of a <em>normal</em> job.</p>
<p><em>Normal</em> jobs must specify account (<code class="docutils literal notranslate"><span class="pre">--account</span></code>), walltime limit
(<code class="docutils literal notranslate"><span class="pre">--time</span></code>) and number of nodes (<code class="docutils literal notranslate"><span class="pre">--nodes</span></code>).  The jobs can specify how
many tasks should run per node and how many CPUs should be used by
each task.</p>
<p>A typical job specification for a normal job would be</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject
#SBATCH --job-name=MyJob
#SBATCH --time=1-0:0:0
#SBATCH --nodes=10 --ntasks-per-node=32
</pre></div>
</div>
<p>This will start 32 tasks (processes) on each node, one for each cpu on the node.</p>
<p>All normal jobs gets exclusive access to whole nodes (all CPUs and
memory).  If a job tries to use more (resident) memory than is
configured on the nodes, it will be killed.  Currently, this limit is
60 GiB, <em>but it can change</em>.  If a job would require more memory per
task than the given 60 GiB split by 32 tasks, the trick is to limit the
number of tasks per node the following way:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject
#SBATCH --job-name=MyJob
#SBATCH --time=1-0:0:0
#SBATCH --nodes=10 --ntasks-per-node=4
</pre></div>
</div>
<p>This example above will use only 4 tasks per node, giving each task 15
GiB.  Note that is the <em>total</em> memory usage on each node that counts,
so one of the tasks can use more than 15 GiB, as long as the total is
less than 60 GiB.</p>
<p>If your job needs more than 60 GiB per task, the only option on Fram
is to use a <em>bigmem</em> job (see below).</p>
<p>To run multithreaded applications, use <code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code> to allocate
the right number of cpus to each task.  For instance:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject
#SBATCH --job-name=MyJob
#SBATCH --time=1-0:0:0
#SBATCH --nodes=4 --ntasks-per-node=2 --cpus-per-task=16
</pre></div>
</div>
<p>Note that setting <code class="docutils literal notranslate"><span class="pre">--cpus-per-task</span></code> does <em>not</em> bind the tasks to the
given number of cpus for <em>normal</em> jobs; it merely sets
<code class="docutils literal notranslate"><span class="pre">$OMP_NUM_THREADS</span></code> so that OpenMP jobs by default will use the right
number of threads.  (It is possible to override this number by setting
<code class="docutils literal notranslate"><span class="pre">$OMP_NUM_THREADS</span></code> in the job script.)</p>
<p>The <a class="reference internal" href="fram/fram_sample_mpi_job.html"><span class="doc std std-doc">Fram Sample MPI Job</span></a> page has an example
of a <em>normal</em> MPI job.</p>
<p>See <a class="reference internal" href="fram/fram_job_placement.html"><span class="doc std std-doc">Fram Job Placement</span></a> for optional
parameters for controlling which nodes a <em>normal</em> job is run on.</p>
</div>
<div class="section" id="preproc">
<h2>Preproc<a class="headerlink" href="#preproc" title="Permalink to this headline">¶</a></h2>
<p><em>Preproc</em> jobs are specified just like <em>normal</em> jobs, except that they
also must specify <code class="docutils literal notranslate"><span class="pre">--qos=preproc</span></code>, and they are only allocated 1 node
(so there is no need to specify <code class="docutils literal notranslate"><span class="pre">--nodes</span></code>).  Otherwise, they are just
like <em>normal</em> jobs.</p>
<p>Example of a general <em>preproc</em> specification (1 node, 4 tasks with 8 CPUs/task):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject --job-name=MyJob
#SBATCH --qos=preproc
#SBATCH --time=1:0:0
#SBATCH --ntasks-per-node=4 --cpus-per-task=8
</pre></div>
</div>
<p>Here is a simpler <em>preproc</em> job (one task on one node):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject --job-name=MyJob
#SBATCH --qos=preproc
#SBATCH --time=1:0:0
</pre></div>
</div>
</div>
<div class="section" id="bigmem">
<h2>Bigmem<a class="headerlink" href="#bigmem" title="Permalink to this headline">¶</a></h2>
<p><em>Bigmem</em> jobs must specify <code class="docutils literal notranslate"><span class="pre">--partition=bigmem</span></code>.  In addition, they
must specify wall time limit, the number of tasks and the amount of
memory memory per cpu.  A <em>bigmem</em> job is assigned the requested cpus
and memory exclusively, but shares nodes with other jobs.  If a
<em>bigmem</em> job tries to use more resident memory than requested, it gets
killed.  The maximal wall time limit for bigmem jobs is 14 days.</p>
<p>Here is an example that asks for 2 nodes, 3 tasks per node, 4 cpus per
task, and 32 GiB RAM per cpu:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject --job-name=MyJob
#SBATCH --partition=bigmem
#SBATCH --time=1-0:0:0
#SBATCH --nodes=2 --ntasks-per-node=3 --cpus-per-task=4
#SBATCH --mem-per-cpu=32G
</pre></div>
</div>
<p>Note that even though the memory specification is called <code class="docutils literal notranslate"><span class="pre">--mem-per-cpu</span></code>, the
memory limit the job gets on the node is for the total usage by all processes
on the node, so in the above example, it would get a limit of 3 * 4 * 32 GiB =
384 GiB. The queue system doesn’t care how the memory usage is divided between
the processes or threads, as long as the total usage on the node is below the
limit.</p>
<p>Also note that contrary to <em>normal</em> jobs, <em>bigmem</em> jobs <em>will</em> be bound to the
cpu cores they are allocated, so the above sample job will have access to 12
cores on each node. However, the three tasks are free to use all cores the job
has access to on the node (12 in this example).</p>
<p>Here is a simpler example, which only asks for 16 tasks (of 1 cpu
each) and 32 GiB RAM per task; it does not care how the tasks are
allocated on the nodes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject --job-name=MyJob
#SBATCH --partition=bigmem
#SBATCH --time=1-0:0:0
#SBATCH --ntasks=16
#SBATCH --mem-per-cpu=32G
</pre></div>
</div>
</div>
<div class="section" id="devel">
<h2>Devel<a class="headerlink" href="#devel" title="Permalink to this headline">¶</a></h2>
<p><em>devel</em> jobs must specify <code class="docutils literal notranslate"><span class="pre">--qos=devel</span></code>.  A <em>devel</em> job is like a <em>normal</em>
job, except that it has restrictions on job length and size.</p>
<p>For instance:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject
#SBATCH --job-name=MyJob
#SBATCH --qos=devel
#SBATCH --time=00:30:00
#SBATCH --nodes=2 --ntasks-per-node=32
</pre></div>
</div>
</div>
<div class="section" id="short">
<h2>Short<a class="headerlink" href="#short" title="Permalink to this headline">¶</a></h2>
<p><em>short</em> jobs must specify <code class="docutils literal notranslate"><span class="pre">--qos=short</span></code>.  A <em>short</em> job is like a <em>normal</em>
job, except that it has restrictions on job length and size.  It
differs from <em>devel</em> jobs in that it allows somewhat longer and larger
jobs, but typically have longer wait time.</p>
<p>For instance:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject
#SBATCH --job-name=MyJob
#SBATCH --qos=short
#SBATCH --time=2:00:00
#SBATCH --nodes=8 --ntasks-per-node=32
</pre></div>
</div>
</div>
<div class="section" id="optimist">
<h2>Optimist<a class="headerlink" href="#optimist" title="Permalink to this headline">¶</a></h2>
<p><em>Optimist</em> jobs are specified just like <em>normal</em> jobs, except that
they also must must specify <code class="docutils literal notranslate"><span class="pre">--qos=optimist</span></code>.  They run on the same
nodes as <em>normal</em> jobs.</p>
<p>An <em>optimist</em> job can be scheduled if there are free resources at
least 30 minutes when the job is considered for scheduling.  However,
it can be requeued before 30 minutes have passed, so there is no
<em>gurarantee</em> of a minimum run time.  When an <em>optimist</em> job is requeued,
it is first sent a <code class="docutils literal notranslate"><span class="pre">SIGTERM</span></code> signal.  This can be trapped in order to
trigger a checkpoint.  After 30 seconds, the job receives a <code class="docutils literal notranslate"><span class="pre">SIGKILL</span></code>
signal, which cannot be trapped.</p>
<p>A simple <em>optimist</em> job specification might be:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SBATCH --account=MyProject
#SBATCH --job-name=MyJob
#SBATCH --partition=optimist
#SBATCH --nodes=4 --ntasks-per-node=32
#SBATCH --time=2:00:00
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Sigma2/Metacenter

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>